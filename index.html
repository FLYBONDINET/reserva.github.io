<div id="reserva-info">
  <p><strong>Casa:</strong> <span id="reserva-casa"></span></p>
  <p><strong>Inicio:</strong> <span id="reserva-inicio"></span></p>
  <p><strong>Fin:</strong> <span id="reserva-fin"></span></p>
  <label>Nombre: <input type="text" id="reserva-nombre" placeholder="Nombre"></label>
  <label>Apellido: <input type="text" id="reserva-apellido" placeholder="Apellido"></label>
  <p><strong>Monto total:</strong> $<span id="reserva-monto">0</span></p>
  <button id="btnReservar">Reservar</button>
</div>

<script>
// reemplazar solo la parte del botón y cálculo de monto
document.getElementById('btnReservar').addEventListener('click', async function() {
  const nombre = document.getElementById('reserva-nombre').value.trim();
  const apellido = document.getElementById('reserva-apellido').value.trim();

  if(!selectedRange || !select.value) return alert("Seleccioná casa y rango de fechas.");
  if(!nombre || !apellido) return alert("Ingresá nombre y apellido.");

  // Calcular días de reserva
  const start = new Date(selectedRange.startStr);
  const end = new Date(selectedRange.endStr);
  const dias = Math.ceil((end.getTime() - start.getTime()) / (1000*3600*24));

  // Buscar monto unitario en allReservas (columna E simulada)
  const reservaProp = allReservas.find(r => r.propiedad === select.value);
  let montoUnitario = parseFloat(reservaProp ? reservaProp.montoUnitario : 0) || 0;
  const montoFinal = montoUnitario * dias;
  document.getElementById('reserva-monto').textContent = montoFinal.toFixed(2);

  const data = new URLSearchParams();
  data.append('propiedad', select.value);
  data.append('inicio', selectedRange.startStr);
  data.append('fin', selectedRange.endStr);
  data.append('nombre', nombre);
  data.append('apellido', apellido);

  const res = await fetch(SCRIPT_URL, { method: 'POST', body: data });
  const result = await res.json();
  if(result.status==="ok"){
    alert(`Reserva registrada! Monto final: $${result.montoFinal}`);
    location.reload();
  } else {
    alert("Error al guardar reserva.");
  }
});
</script>
